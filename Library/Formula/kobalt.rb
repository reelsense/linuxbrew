class Kobalt < Formula
  desc "Build system"
  homepage "http://beust.com/kobalt"
  url "https://github.com/cbeust/kobalt/releases/download/0.666/kobalt-0.666.zip"
  sha256 "c43f225dadf4ca8431018a68573d38408a8fa84afde33860bed656f150b3d469"

  bottle :unneeded

  def install
    libexec.install %w[kobaltw kobalt]
    kobaltw = libexec/"kobaltw"
    kobaltw.chmod 0755
    bin.write_exec_script kobaltw
  end

  test do
    ENV.java_cache

    (testpath/"src/main/kotlin/com/A.kt").write <<-EOS.undent
      package com
      class A
      EOS

    (testpath/"kobalt/src/Build.kt").write <<-EOS.undent
      import com.beust.kobalt.*
      import com.beust.kobalt.api.*
      import com.beust.kobalt.plugin.packaging.*

      val p = project {
        name = "test"
        version = "1.0"
        assemble {
        jar {}
      }
    }
    EOS

    system "#{bin}/kobaltw", "assemble"
    output = "kobaltBuild/libs/test-1.0.jar"
    assert File.exist?(output), "Couldn't find #{output}"
  end
end
